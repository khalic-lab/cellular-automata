<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Cellular Automata</title>
  <link rel="stylesheet" href="css/viewer3d.css">
</head>
<body>
  <div id="canvas-container"></div>

  <div id="ui">
    <h1>3D Cellular Automata</h1>

    <!-- Controls -->
    <div class="control-group">
      <label>Controls</label>
      <div class="control-row">
        <button id="playPause">Play</button>
        <button id="stop" class="secondary">Stop</button>
        <button id="step" class="secondary">Step</button>
        <button id="reset" class="secondary">Reset</button>
      </div>
    </div>

    <!-- Rule Preset -->
    <div class="control-group">
      <label>Rule Preset</label>
      <select id="preset">
        <optgroup label="Growth">
          <option value="amoeba">Amoeba - Organic blobs</option>
          <option value="crystal">Crystal - From tiny seed</option>
          <option value="crystal2">Crystal 2 - Fractal growth</option>
          <option value="builder">Builder - Structured</option>
          <option value="spiky" selected>Spiky - Sharp growth</option>
          <option value="ripple">Ripple Cube - Waves</option>
          <option value="coral">Coral - Branching</option>
          <option value="pyroclastic">Pyroclastic - Explosive</option>
        </optgroup>
        <optgroup label="Patterns">
          <option value="445">445 - Symmetric</option>
          <option value="678">678 - Organic</option>
          <option value="clouds">Clouds - Diffuse</option>
          <option value="slow-decay">Slow Decay - Dissolving</option>
        </optgroup>
        <optgroup label="Custom" id="customRulesGroup">
          <option value="__custom__">Edit Custom Rule...</option>
        </optgroup>
      </select>
    </div>

    <!-- Rule Editor (hidden by default) -->
    <div class="control-group" id="ruleEditor" style="display:none;">
      <label>Rule Editor</label>
      <div style="margin-bottom:8px;">
        <input type="text" id="ruleName" placeholder="Rule name">
      </div>

      <div style="font-size:10px; color:#555; margin-bottom:6px; text-align:center;">
        Click neighbor counts (0-26) to toggle. Each cell has 26 neighbors in 3D.
      </div>

      <div style="margin-bottom:8px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:4px;">
          <span style="font-size:11px; color:#00ff88;">Birth (dead -> alive)</span>
          <span id="birthSummary" style="font-size:10px; color:#666;"></span>
        </div>
        <div id="birthGrid"></div>
      </div>

      <div style="margin-bottom:8px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:4px;">
          <span style="font-size:11px; color:#00aaff;">Survival (alive -> alive)</span>
          <span id="survivalSummary" style="font-size:10px; color:#666;"></span>
        </div>
        <div id="survivalGrid"></div>
      </div>

      <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; margin-bottom:8px;">
        <div>
          <span style="font-size:11px; color:#888;">States</span>
          <input type="number" id="ruleStates" value="2" min="2" max="20">
        </div>
        <div>
          <span style="font-size:11px; color:#888;">Density %</span>
          <input type="number" id="ruleInitDensity" value="40" min="1" max="100">
        </div>
        <div>
          <span style="font-size:11px; color:#888;">Radius</span>
          <input type="number" id="ruleInitRadius" value="7" min="0" max="50">
        </div>
      </div>
      <div class="control-row">
        <button id="ruleApply" style="flex:1; padding:6px;">Apply</button>
        <button id="ruleSave" class="secondary" style="flex:1; padding:6px;">Save</button>
        <button id="ruleDelete" class="secondary" style="flex:1; padding:6px;">Delete</button>
      </div>
      <div class="control-row" style="margin-top:6px;">
        <button id="ruleExport" class="secondary" style="flex:1; padding:6px; font-size:11px;">Export All</button>
        <button id="ruleImport" class="secondary" style="flex:1; padding:6px; font-size:11px;">Import</button>
      </div>
      <input type="file" id="ruleImportFile" accept=".json" style="display:none;">
      <div id="savedRulesList"></div>
    </div>

    <!-- Grid Size -->
    <div class="control-group">
      <label>Grid Size</label>
      <select id="gridSize">
        <option value="10">10 x 10 x 10</option>
        <option value="15">15 x 15 x 15</option>
        <option value="20">20 x 20 x 20</option>
        <option value="30">30 x 30 x 30</option>
        <option value="40">40 x 40 x 40</option>
        <option value="50" selected>50 x 50 x 50</option>
        <option value="75">75 x 75 x 75</option>
        <option value="100">100 x 100 x 100</option>
        <option value="150">150 x 150 x 150</option>
        <option value="200">200 x 200 x 200</option>
        <option value="300">300 x 300 x 300</option>
        <option value="500">500 x 500 x 500</option>
      </select>
    </div>

    <!-- Timeline -->
    <div class="control-group">
      <label>Timeline</label>
      <input type="range" id="timeline" min="0" max="0" value="0" step="1">
      <div class="slider-value" id="timelineValue">0 / 0</div>
    </div>

    <!-- World Center -->
    <div class="control-group">
      <label>World Center</label>
      <div class="center-controls">
        <div class="center-row">
          <span>X:</span>
          <input type="range" id="centerX" min="-50" max="50" value="0" step="1">
          <span id="centerXValue">0</span>
        </div>
        <div class="center-row">
          <span>Y:</span>
          <input type="range" id="centerY" min="-50" max="50" value="0" step="1">
          <span id="centerYValue">0</span>
        </div>
        <div class="center-row">
          <span>Z:</span>
          <input type="range" id="centerZ" min="-50" max="50" value="0" step="1">
          <span id="centerZValue">0</span>
        </div>
      </div>
    </div>

    <!-- Speed -->
    <div class="control-group">
      <label>Speed (ms/frame)</label>
      <input type="range" id="speed" min="50" max="1000" value="50" step="50">
      <div class="slider-value" id="speedValue">50ms</div>
      <div class="control-row" style="margin-top:8px">
        <button class="secondary" id="speedFast" style="flex:1;padding:6px">Fast</button>
        <button class="secondary" id="speedNormal" style="flex:1;padding:6px">Normal</button>
        <button class="secondary" id="speedSlow" style="flex:1;padding:6px">Slow</button>
      </div>
    </div>

    <!-- Initial Density -->
    <div class="control-group">
      <label>Initial Density</label>
      <input type="range" id="density" min="0.1" max="1.0" value="0.5" step="0.05">
      <div class="slider-value" id="densityValue">50%</div>
    </div>

    <!-- Starting Shape -->
    <div class="control-group">
      <label>Starting Shape</label>
      <select id="startShape">
        <option value="sphere">Sphere</option>
        <option value="cube">Cube</option>
        <option value="tetrahedron">Tetrahedron</option>
        <option value="octahedron">Octahedron</option>
        <option value="dodecahedron">Dodecahedron</option>
        <option value="icosahedron">Icosahedron</option>
        <option value="noise">Random Noise (full grid)</option>
      </select>
    </div>

    <!-- Statistics -->
    <div class="control-group">
      <label>Statistics</label>
      <div class="stats">
        <div class="stat">
          <div class="stat-value" id="generation">0</div>
          <div class="stat-label">Generation</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="population">0</div>
          <div class="stat-label">Population</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="densityStat">0%</div>
          <div class="stat-label">Density</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="stepTime">-</div>
          <div class="stat-label">Step Time</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="computeMode">cpu</div>
          <div class="stat-label">Compute</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="maxGen">0</div>
          <div class="stat-label">Max Gen</div>
        </div>
      </div>
    </div>

    <!-- Population History -->
    <div class="control-group">
      <label>Population History</label>
      <canvas id="popGraph" width="200" height="40"></canvas>
    </div>

    <!-- State Distribution -->
    <div class="control-group">
      <label>State Distribution</label>
      <div id="stateBar"></div>
      <div id="stateLegend"></div>
    </div>

    <!-- Render Mode (NEW) -->
    <div class="control-group">
      <label>Render Mode</label>
      <select id="renderMode">
        <option value="cubes" selected>Cubes (Default)</option>
        <option value="particles">Particle Cloud</option>
        <option value="marchingCubes">Marching Cubes (Smooth)</option>
        <option value="volumetric">Volumetric Clouds</option>
      </select>
    </div>

    <!-- Cell Scale (NEW) -->
    <div class="control-group">
      <label>Cell Scale</label>
      <input type="range" id="cellScale" min="0.5" max="1.5" value="1.0" step="0.05">
      <div class="slider-value" id="cellScaleValue">1.0</div>
    </div>

    <!-- Display Mode -->
    <div class="control-group">
      <label>Display Mode</label>
      <select id="displayMode">
        <option value="all">All Cells</option>
        <option value="shell">Shell Only (Surface)</option>
      </select>
    </div>

    <!-- Post Processing (NEW) -->
    <div class="control-group">
      <label>Post Processing</label>
      <select id="postEffect">
        <option value="none" selected>None</option>
        <option value="bloom">Bloom</option>
        <option value="ssao">SSAO (Ambient Occlusion)</option>
        <option value="bloom+ssao">Bloom + SSAO</option>
      </select>
    </div>

    <!-- Bloom Controls (NEW - hidden by default) -->
    <div class="control-group" id="bloomControls" style="display:none">
      <label>Bloom Strength</label>
      <input type="range" id="bloomStrength" min="0" max="2" value="0.5" step="0.1">
      <div class="slider-value" id="bloomStrengthValue">0.5</div>
    </div>

    <!-- SSAO Controls (NEW - hidden by default) -->
    <div class="control-group" id="ssaoControls" style="display:none">
      <label>SSAO Radius</label>
      <input type="range" id="ssaoRadius" min="1" max="32" value="8" step="1">
      <div class="slider-value" id="ssaoRadiusValue">8</div>
    </div>

    <!-- Slice View -->
    <div class="control-group">
      <label>Slice View</label>
      <div class="center-controls">
        <div class="center-row">
          <span>Axis:</span>
          <select id="sliceAxis" style="flex:1">
            <option value="off">Off</option>
            <option value="x">X (YZ plane)</option>
            <option value="y">Y (XZ plane)</option>
            <option value="z">Z (XY plane)</option>
          </select>
        </div>
        <div class="center-row" id="slicePosRow" style="display:none">
          <span>Pos:</span>
          <input type="range" id="slicePos" min="0" max="19" value="10">
          <span id="slicePosValue">10</span>
        </div>
      </div>
      <canvas id="sliceCanvas" width="200" height="200" style="display:none;"></canvas>
    </div>

    <!-- Camera -->
    <div class="control-group">
      <label>Camera</label>
      <div class="control-row">
        <button class="secondary" id="camFront" style="flex:1;padding:6px">Front</button>
        <button class="secondary" id="camTop" style="flex:1;padding:6px">Top</button>
        <button class="secondary" id="camCorner" style="flex:1;padding:6px">Corner</button>
      </div>
    </div>
  </div>

  <div id="help">
    <strong>Mouse:</strong> Drag to rotate, Scroll to zoom, Right-drag to pan
  </div>

  <script type="module" src="js/main.js"></script>
</body>
</html>
